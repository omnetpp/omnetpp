'
' Add the following macro into PowerPoint.
' Based on: http://www.rdpslides.com/pptfaq/FAQ00481.htm
'
Sub ExportImages()

    Dim oSlides As Slides
    Dim oSl As Slide
    Dim oSh As Shape
    Dim notesText As String
    Dim fromFile, toFile As String
    Dim slideNumber As Integer

    ' Get a filename to store the collected text
    strDir = ActivePresentation.Path
    strDir = InputBox("Export images into 'figures' subdirectory of:", "Output directory", strDir)
    
    ' did user cancel?
    If strDir = "" Then
        Exit Sub
    End If

    ' save gifs
    ActivePresentation.SaveAs FileName:=strDir & "\figures.gif", FileFormat:=ppSaveAsGIF, EmbedTrueTypeFonts:=msoFalse
    If Err.Number <> 0 Then     ' we have a problem
        MsgBox "Error during exporting. Wrong directory name?"
        Exit Sub
    End If

    Set fs = CreateObject("Scripting.FileSystemObject")

    ' Get the notes text
    Set oSlides = ActivePresentation.Slides
    For Each oSl In oSlides
        For Each oSh In oSl.NotesPage.Shapes
        If oSh.PlaceholderFormat.Type = ppPlaceholderBody Then
            If oSh.HasTextFrame Then
                If oSh.TextFrame.HasText Then
                    ' 2 lines added by Andras Varga
                    slideNumber = oSl.slideNumber
                    notesText = oSh.TextFrame.TextRange.Text
                    fromFile = strDir & "\figures\Slide" & CStr(slideNumber) & ".gif"
                    toFile = strDir & "\figures\" & notesText & ".gif"
                    
                    On Error Resume Next
                    fs.DeleteFile toFile
                    On Error GoTo 0
                    
                    fs.MoveFile fromFile, toFile
                    ' strNotesText = strNotesText & "Slide: " & CStr(oSl.SlideNumber) & vbCrLf _
                    ' & oSh.TextFrame.TextRange.Text & vbCrLf & vbCrLf
                End If
            End If
        End If
        Next oSh
    Next oSl

End Sub
