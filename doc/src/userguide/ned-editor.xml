<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
    "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="ned-editor">
  <title>Editing NED Files</title>

  <sect1>
    <title>Overview</title>
    <para>
      When you double-click a .ned file in the IDE, it will open in the NED editor. Like
      its predecessor
      <command>gned</command>
      from OMNeT++ 2.x and 3.x, the new NED editor is a dual-mode editor: in the graphical
      mode you can edit the network using the mouse, and the textual mode allows you to
      work directly on the NED source.
    </para>
    <para>
      The syntax of NED files has changed from the 3.x version. The new syntax
      accommodates many more languages features such as inheritance and properties, and it
      is also more consistent, making NED source files easier to read and write. The NED
      editor primarily supports the new syntax: it is still possible to read and display
      NED files with the old syntax, many of the advanced features, however, (syntax
      highlighting, content assistance etc.) will not work. There is automatic conversion
      from the old syntax to the new, available both from the NED editor and as an
      external utility program (
      <command>nedtool</command>
      ).
    </para>
    <para>
      The
      <command>gned</command>
      program from OMNeT++ 3.x and 2.x viewed NED files in isolation. In contrast, the
      OMNeT++ IDE gathers information from all .ned files in all open OMNeT++ projects,
      and makes this information available to the NED editor. This is necessary because in
      OMNeT++ 4.0, modules may inherit parameters, visual appearance or even submodules
      and connections from other modules, so it is only possible to display a compound
      module correctly if all related NED definitions are available.
    </para>
    <note>
      As a side effect, currently if there are two modules with the same name anywhere in
      the workspace, they will collide, and both will be marked with an error.
      Furthermore, the name will be treated as undefined, and any other modules depending
      on it will also generate an error. (Thus, a “no such module type” error may mean
      that actually there are more than one definitions which nullify each other.)
    </note>
    <para>
      When the IDE detects errors in a NED file, the problem will be flagged with an error
      marker in the Project Explorer, and the Problems View will be updated to show the
      description and location of the problem. Also error markers will appear in the text
      window or on the graphical representation of the problematic component. Opening a
      NED file which contains an error will open the file in text mode. Switching to
      graphical mode is possible only if the NED file is syntactically correct.
    </para>
  </sect1>
  <sect1>
    <title>Creating new NED files</title>
    <para>
      Once you have an empty OMNeT++ project, you can create new NED files. Choosing
      <guimenuitem>File|New|Network Description File</guimenuitem>
      from the menu will bring up a wizard where you can specify the target directory and
      the file/module name. You may choose to create an empty NED file, or a
      simple/compound module, or a network. Once you press the
      <guibutton>Finish</guibutton>
      button, a new NED file will be created with the requested content.
      <picture file="pictures/NED-NewWizard.png">Creating a new NED file</picture>
    </para>
    <tip>
      It is a good practice that the NED file and the contained module have the same name.
      For example, a compound module named Wireless42 should be defined within its own
      Wireless42.ned file.
    </tip>
    <sect2>
      <title>NED Source Folders</title>
      <para>
        It is possible to specify which folders the IDE should scan for NED files and will
        use as the base directory for your NED package hierarchy. The IDE will not use any
        NED files outside the specified NED Source Folders and those files will be opened
        in a standard text editor. To specify the directory where the NED files will be
        stored right click on the project in the Project Explorer and choose Properties.
        Select the OMNeT++/Ned Source Folders page and click on the folders where you
        store your NED files. The default value is the project root.
      </para>
      <picture file="pictures/NED-SourceFolders.png">
        Specifying which folder will hold our NED files
      </picture>
    </sect2>
  </sect1>

  <sect1>
    <title>Using the NED editor</title>
    <para>
      If you want to open a NED file, just double-click its icon in the Project Explorer.
      If the NED file can be parsed without an error, the graphical representation of the
      file will be opened, otherwise (errors in the file) the text view will be opened,
      and annotated with error markers.
    </para>
    <warning>
      Only files contained in NED Source Folders will be opened with the graphical editor.
      If a NED file is not in the NED Source Folders it will be opened by a standard text
      editor.
    </warning>
    <para>
      You can switch between graphical and source editing mode using the tabs at the
      bottom of the editor or using the
      <keycap>Ctrl+PGUP/PGDN</keycap>
      key combinations. The editor will try to keep the selection during the switch:
      selecting an element in a graphical view and then switching to text view will move
      the cursor to the related element in the NED file. When switching back to graphical
      view, the graphical editor will try to select the element that corresponds to the
      cursor location in the NED source. This allows you to keep the context even if you
      switch back and forth regularly.
    </para>
    <sect2>
      <title>Editing in graphical mode</title>
      <para>
        The graphical editor represents the visible parts of the loaded NED file. Simple
        modules, compound modules and networks are represented by figures or icons. Each
        NED file can contain more than one module or network. In this case the
        corresponding figures will appear in the same order as they are found in the NED
        file.
      </para>
      <tip>
        It is a good practice to place only a single module or network into a NED files
        and name the file according to the module name.
      </tip>
      <para>
        Simple modules and submodules are represented as icons while compound modules and
        networks are rectangles where other submodules can be dropped. Connections between
        submodules are represented either by lines or arrows depending whether the
        connection was one-directional or bi-directions. Submodules can be dragged or
        resized by the mouse and connected by using the Connection Tool in the palette.
      </para>
      <picture file="pictures/NED-GraphEditor.png">Graphical NED Editor</picture>
      <para>
        The palette is normally at the right of the editor area. The upper part of the
        palette contains the basic tools: selector, connection selector, and the
        connection creator tool. Click a palette item and then just click into the module
        where you want to place/activate it. The mouse pointer will give you feedback
        whether the requested operation is allowed. The middle part of the toolbox
        contains the basic elements that can be placed at the top level in a NED file
        (simple module, compound module, interface, channel etc.) and a "generic"
        submodule. Click on any of these and then click into the editor area to create an
        instance. The bottom part of the palette contains all module types that can be
        instantiated as a submodule. They are shortcuts for creating a generic submodule
        and then modifying its type. They will display the default icon (if any) and a
        short documentation if you hover the mouse over them. You may configure the
        Palette by right clicking on a button and selecting
        <guimenuitem>Settings...</guimenuitem>
        or filter its content by selecting
        <guimenuitem>Select Packages...</guimenuitem>
      </para>
      <para>
        Right-clicking any element in the edited NED file will bring up a context menu
        allowing several actions like changing the icon, pinning/unpinning a submodule,
        re-layouting a compound module, or deleting/renaming the element. There are also
        items to activate various views, for example the Properties View where you can
        edit properties of the element.
      </para>
      <para>
        Hovering over an element will display its documentation (the comment in the NED
        source above the definition) in a “tooltip” if it has one. Pressing
        <keycap>F2</keycap>
        will make the tooltip window persistent, so that it can be resized and scrolled
        for more convenient reading.
      </para>
      <sect3>
        <title>Creating modules</title>
        <para>
          To create a module or a submodule, click on the appropriate palette item, and
          then click where you want to place the new element. Submodules can be placed
          only inside compound modules or networks while other types can be dropped
          directly in the editor window.
        </para>
      </sect3>
      <sect3>
        <title>Creating and changing connections</title>
        <para>
          Select the
          <guimenuitem>connection tool</guimenuitem>
          (if there are channels defined in the project, you can use the drop down to
          select which channel type the connection should have). First click the source
          module, then the destination. A pop-up menu will appear, asking which gates
          should be connected on the two selected modules. The tool will offer only valid
          connections (for example, it will not offer connecting two output gates).
        </para>
      </sect3>
      <sect3>
        <title>Reconnecting modules</title>
        <para>
          Clicking and dragging a connection end point to another module will reconnect it
          optionally asking for the gate which should be connected. If you want to change
          only the gate just drag the connection end point and drop it to the original
          module. A popup will appear asking for the source or destination gate.
        </para>
      </sect3>
      <sect3>
        <title>Selecting elements</title>
        <para>
          Selecting an element is done by clicking on it or by dragging a rectangle around
          the target modules. Compound modules can be selected by clicking on their border
          or title. If you want to select only connections with the selection rectangle,
          use the
          <guimenuitem>connection selector</guimenuitem>
          tool in the dropdown menu of the
          <guimenuitem>connection tool</guimenuitem>
          . The
          <keycap>CTRL</keycap>
          and
          <keycap>SHIFT</keycap>
          key can be used to add/remove to/from the current selection. Note that the
          keyboard (arrow keys) can also be used to navigate between submodules. You can
          also select using a selection rectangle by dragging the
        </para>
      </sect3>
      <sect3>
        <title>Undo, redo, deleting elements</title>
        <para>
          Use
          <keycap>Ctrl+Z</keycap>
          ,
          <keycap>Ctrl+Y</keycap>
          for undo/redo, and the DEL key for deletion. These functions are also available
          in the Edit menu and in the context menu of the selected element.
        </para>
      </sect3>
      <sect3>
        <title>Moving and resizing elements</title>
        <para>
          You can move/resize the selected elements with the mouse. Holding down
          <keycap>SHIFT</keycap>
          during move will perform a constrained (horizontal, diagonal or vertical) move
          operation.
          <keycap>CTRL</keycap>
          + resize will resize around the object’s center.
          <keycap>SHIFT</keycap>
          + resize will keep the aspect ratio of the element.
        </para>
        <para>
          If you turn on
          <guimenuitem>Snap to Geometry</guimenuitem>
          in the
          <guimenu>View</guimenu>
          menu, helper lines will appear to allow you to align to other modules. Selecting
          more than one submodule activates the
          <guimenuitem>Alignment</guimenuitem>
          menu (found both in the View menu and in the context menu).
        </para>
      </sect3>
      <sect3>
        <title>Copying elements</title>
        <para>
          Holding down
          <keycap>CTRL</keycap>
          while dragging will clone the module(s). Copy/Paste can be also used both on
          single modules and with group selection.
        </para>
      </sect3>
      <sect3>
        <title>Zooming</title>
        <para>
          Zooming in and out is possible from the View menu, or using
          <keycap>Ctrl+-</keycap>
          or
          <keycap>Ctrl+=,</keycap>
          or holding down
          <keycap>CTRL</keycap>
          and using the mouse wheel.
        </para>
      </sect3>
      <sect3>
        <title>Pinning and unpinning, re-layouting</title>
        <para>
          A submodule display string may or may not contain explicit coordinates for the
          submodule; if it does not, then the location of the submodule will be determined
          by the layouting algorithm. A submodule with explicit coordinates is pinned; one
          without is unpinned. The Pin action inserts the current coordinates into the
          display string, and the Unpin action removes them. Moving a submodule also
          automatically pins it. The position of an unpinned module is undetermined, and
          may change every time the layouting algorithm runs. For convenience, the
          layouter does not run when a submodule gets unpinned (so that the submodule does
          not jump away on unpinning), but this also means that unpinned submodules may
          appear at different locations next time the same NED file gets opened.
        </para>
      </sect3>
      <sect3>
        <title>Choosing icon for a module</title>
        <para>
          To choose an icon for a module right click on it and select the
          <guimenuitem>Choose an Icon...</guimenuitem>
          menu item from the context menu or select the module and modify the icon
          property in the Properties View.
        </para>
      </sect3>
      <sect3>
        <title>Navigation</title>
        <para>
          Double-clicking a submodule will open the corresponding module type in a NED
          editor. Selecting an element in the graphical editor and then switching to text
          mode will place the cursor near the previously selected element in the text
          editor.
        </para>
        <para>
          Navigating inside a longer NED file is much easier if you open the Outline View
          to see the internal structure of the file. Selecting an element in the outline
          will select the same element in the graphical editor.
        </para>
        <para>
          If you want to see the selected element in a different view select the element
          and right click on it. Choose
          <guimenuitem>Show In</guimenuitem>
          from the context menu and select the desired view.
        </para>
      </sect3>
      <sect3>
        <title>Opening a NED type</title>
        <para>
          If you know only the name of a type of a module or other NED element, you can
          use the Open NED Type dialog by pressing
          <keycap>Ctrl+SHIFT-N</keycap>
          . Type the name, or search with wildcards. The requested type will be opened in
          an editor. This feature is not tied to the graphical editor: the Open NED Type
          dialog is available from anywhere in the IDE.
        </para>
      </sect3>
      <sect3>
        <title>Setting properties</title>
        <para>
          Elements of the display string and other properties associated with the selected
          elements can be edited in the Properties View. The property view is grouped and
          hierarchically organized however you can switch off this behavior on the view
          toolbar. Most properties can be edited directly in the view but some has also
          specific editors that can be activated by pressing the ellipsis button at the
          end of the field. Fields marked with a small light bulb support content assist.
          Try the
          <keycap>CTRL+SPACE</keycap>
          key combination to get a list of posible values.
        </para>
      </sect3>
      <note>
        The following functions are available only in source editing mode:
        <itemizedlist>
          <listitem>
            Creating or modifying module, submodule and channel parameters
          </listitem>
          <listitem>Creating or modifying gates</listitem>
          <listitem>Creating or modifying inner types in compound modules</listitem>
          <listitem>Creating grouped and conditional connections</listitem>
          <listitem>Adding or editing properties</listitem>
          <listitem>Adding or editing imports</listitem>
          <listitem>Creating submodule vectors</listitem>
          <listitem>Editing submodule vector size</listitem>
        </itemizedlist>
      </note>
    </sect2>

    <sect2>
      <title>Editing in source mode</title>
      <para>
        The NED source editor supports all functionality that one can expect from an
        Eclipse-based text editor, such as syntax highlighting (for the new NED syntax),
        clipboard cut/copy/paste and unlimited undo/redo. A summary of these features:
      </para>

      <itemizedlist>
        <listitem>
          <para>
            Undo (
            <keycap>Ctrl+Z</keycap>
            ), Redo (
            <keycap>Ctrl+Y</keycap>
            )
          </para>
        </listitem>
        <listitem>
          <para>
            Indenting/unindenting code blocks with
            <keycap>TAB/Shift+TAB</keycap>
          </para>
        </listitem>
        <listitem>
          <para>
            Correct indentation (NED syntax aware) (
            <keycap>Ctrl+I</keycap>
            )
          </para>
        </listitem>
        <listitem>
          <para>
            Find (
            <keycap>Ctrl+F</keycap>
            ), incremental search (
            <keycap>Ctrl+J</keycap>
            )
          </para>
        </listitem>
        <listitem>
          <para>
            Moving lines with
            <keycap>ALT+UP/DOWN</keycap>
          </para>
        </listitem>
        <listitem>
          <para>Folding regions (NED syntax aware)</para>
        </listitem>
      </itemizedlist>
      <note>
        <keycap>Ctrl+Shift+L</keycap>
        pops up a window with all keyboard bindings listed.
      </note>
      <para>
        The NED source is continually parsed as you type, and errors and warnings are
        displayed as markers on the editor rulers. At times when the NED text is
        syntactically correct, the editor has full knowledge of “what is what” in the text
        buffer.
      </para>
      <picture file="pictures/NED-TextEditor.png">NED Source Editor</picture>
      <para>
        Hovering the mouse over a NED type name will display the documentation in a
        "tooltip" window, which can be made persistent by hitting
        <keycap>F2</keycap>
        .
      </para>
      <sect3>
        <title>Converting from old to new NED format</title>
        <para>
          If you have a NED file with older syntax, you still can open it. A context menu
          item allows you to convert it to the new syntax. If the NED file is already
          using the new syntax the
          <guimenuitem>Convert to 4.0 Format</guimenuitem>
          menu item is disabled.
        </para>
      </sect3>
      <sect3>
        <title>Content assist</title>
        <para>
          If you need help, just press
          <keycap>Ctrl+SPACE</keycap>
          . The editor will offer possible words or templates. This is context sensitive,
          so it will offer only valid ones. Content assist is also a good way of exploring
          the new NED syntax and features.
        </para>
        <picture file="pictures/NED-TextEditorCA.png">
          NED Source Editor with content assist activated
        </picture>
      </sect3>
      <sect3>
        <title>Searching in NED Files</title>
        <para>
          Selecting a text or moving the cursor over a word and pressing
          <keycap>CTRL+SHIFT+G</keycap>
          searches for the selection in all NED files in the open projects. This function
          lets you quickly find references to the word or type currently under the cursor.
          The results are shown in the standard Search View.
        </para>
      </sect3>
      <sect3>
        <title>Organizing imports</title>
        <para>
          Sometimes it is very inconvenient to add the necessary import statements to the
          beginning of the NED file by hand. The IDE can do it for you (almost)
          automatically. Pressing
          <keycap>CTRL+SHIFT+O</keycap>
          will try to insert all needed import statement and asks you to specify the used
          packages in case of ambiguity.
        </para>
      </sect3>
      <sect3>
        <title>Cleaning up NED files</title>
        <para>
          This function does a general repair on all selected NED files. Throws out or
          adds import statement as needed, checks whether the file's package declaration
          is correct and reformats the source code. It can be activated by clicking on the
          <guimenuitem>Clean Up NED Files</guimenuitem>
          menu item from the main menu.
        </para>
      </sect3>
      <sect3>
        <title>Formatting the source code</title>
        <para>
          It is possible to reformat the whole NED file according to the recommended
          coding guidelines by activating the
          <guimenuitem>Format SOurce</guimenuitem>
          context menu item or by pressing the
          <keycap>CTRL+SHIFT+F</keycap>
          key combination.
        </para>
        <note>
          Using the graphical editor and switching to source mode automatically re-formats
          the NED source code.
        </note>
      </sect3>

      <sect3>
        <title>Navigation</title>
        <para>
          Holding the
          <keycap>CTRL</keycap>
          key and clicking on an HTTP link or on a module type will jump to the target
          page or type definition.
        </para>
        <para>
          If you switch to graphical mode from text mode, the editor will try to locate
          the NED element under the cursor and select it in the graphical editor.
        </para>
        <para>Bookmarks and navigation history fully work as well.</para>
      </sect3>
    </sect2>
    <commercial>
      <sect2>
        <title>Other features</title>
        <sect3>
          <title>Printing</title>
          <para>You can print the content of the</para>
        </sect3>
        <sect3>
          <title>Exporting images</title>
          <para>
            To export a compound module as a picture, select the compound module and bring
            up its context menu, select Export Image... and choose file name and type. The
            module will be exported to the file system. BMP, PNG, JPEG, SVG and PDF
            formats are supported.
          </para>
          <para>
            It is also possible to export images from all (or selected) NED files; the
            corresponding wizard can be found under File|Export… in the menu.
          </para>
        </sect3>
      </sect2>
    </commercial>
  </sect1>

  <sect1>
    <title>Associated Views</title>
    <para>
      There are several views related to the NED editor. These views can be displayed (if
      not already open) by choosing Window|Show View in the menu or by selecting a NED
      element in the graphical editor and selecting
      <guimenuitem>Show In</guimenuitem>
      from the context menu.
    </para>
    <sect2>
      <title>Outline View</title>
      <para>
        The Outline View allows an overview of the current NED file. Clicking on an
        element will focus the corresponding element in the text or graphical view. It has
        limited editing functionality; you can copy/cut/paste and delete an object.
      </para>
      <picture file="pictures/NED-OutlineView.png">Outline View</picture>
    </sect2>
    <sect2>
      <title>Property View</title>
      <para>
        The Property View contains all properties of the selected graphical element.
        Visual appearance, name, type and other properties can be changed in this view.
        Some fields has specialized editors that can be activated by clicking on the
        ellipsis button in the field editor. Fields marked with a small light bulb icon
        has content assist support. Pressing
        <keycap>CTRL+SPACE</keycap>
        will offer the possible values the field can hold.
      </para>
      <picture file="pictures/NED-PropertiesView.png">Properties View</picture>
    </sect2>
    <sect2>
      <title>Palette View</title>
      <para>
        The Palette is normally displayed on the left or right side of the editor area,
        and contains tools to create various NED elements. It is possible to hide it by
        clicking on the little arrow in the corner, and to detach it from the editor and
        display it as a normal Eclipse view (Window|Show View|Other…|General|Palette).
      </para>
    </sect2>
    <sect2>
      <title>Problems View</title>
      <para>
        The Problems View contains error and warning messages generated by the parser.
        Double-clicking a line will open the problematic file and move to the appropriate
        marker.
      </para>
      <picture file="pictures/NED-ProblemsView.png">Problems View</picture>
    </sect2>
    <sect2>
      <title>NED Inheritance View</title>
      <para>
        The Inheritance View displays the relationship between different NED types. Select
        a NED element in the graphical editor or move the cursor into a NED definition and
        the Inheritance view will display the ancestors of this type. If you do not want
        the view to follow the selection in the editor, click the Pin icon on the view
        toolbar. This will fix the displayed type to the currently selected one.
      </para>
      <picture file="pictures/NED-InheritanceView.png">NED Inheritance View</picture>
    </sect2>
    <sect2>
      <title>Module Hierarchy View</title>
      <para>
        The Module Hierarchy View shows the contained submodules and their parameters,
        several levels deep. It also displays the parameters and other contained features.
      </para>
      <picture file="pictures/NED-ModuleHierarchyView.png">Module Hierarchy View</picture>
    </sect2>
    <sect2>
      <title>Parameters View</title>
      <para>
        The Parameters View shows parameters of the selected module, including inherited
        parameters, the values of the parameters and the origin of the values (NED
        definition, INI file or undefined).
      </para>
      <picture file="pictures/NED-ParametersView.png">Outline View</picture>
    </sect2>
    <para>The latter two views have their main uses with the Inifile Editor.</para>
  </sect1>

</chapter>
